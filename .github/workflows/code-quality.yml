name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'
        
    - name: Cache Maven dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2
        
    # 代码格式检查（暂时跳过）
    - name: Skip checkstyle for now
      run: echo "Skipping checkstyle checks"
      
    # 静态代码分析（暂时跳过）
    - name: Skip SpotBugs for now
      run: echo "Skipping SpotBugs checks"
      
    # 代码覆盖率检查
    - name: Generate coverage report
      run: mvn jacoco:report -B
      
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: sky-server/target/site/jacoco/jacoco.xml
        flags: unittests
        name: codecov-umbrella
